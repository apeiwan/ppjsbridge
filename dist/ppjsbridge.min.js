/*!@apeiwan/ppjsbridge released@1.0.0*/
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n=n||self).PPJSBridge=e()}(this,(function(){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(e)}function e(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function t(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?e(Object(r),!0).forEach((function(e){var t,o,i;t=n,i=r[o=e],o in t?Object.defineProperty(t,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))}))}return n}function r(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n)){var t=[],r=!0,o=!1,i=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done)&&(t.push(a.value),!e||t.length!==e);r=!0);}catch(n){o=!0,i=n}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return t}}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}for(var o,i=window.navigator.userAgent,a=i.match(/(Android);?[\s\/]+([\d.]+)?/),s=i.match(/(iPad).*OS\s([\d_]+)/),u=i.match(/(iPod)(.*OS\s([\d_]+))?/),c=!s&&i.match(/(iPhone\sOS|iOS)\s([\d_]+)/),d=/pipipeiwan/i.test(window.navigator.userAgent),f="1.1.7",l=a?"android":s||u||c?"ios":"pc",p=function(n){return n=n||Object.create(null),{on:function(e,t){(n[e]||(n[e]=[])).push(t)},off:function(e,t){n[e]&&n[e].splice(n[e].indexOf(t)>>>0,1)},emit:function(e,t){(n[e]||[]).slice().map((function(n){n(t)})),(n["*"]||[]).slice().map((function(n){n(e,t)}))}}}(),v=function(n,e){var t,r=String(n).split(".").map((function(n){return parseInt(n)})),o=String(e).split(".").map((function(n){return parseInt(n)})),i=Math.max(r.length,o.length);if(null==n||null==e)throw new Error;if(0==n.length&&0==e.length)return 0;if(0==n.length)return-1;if(0==e.length)return 1;for(var a=0;a<i&&0==(t=s(r[a],o[a]));a++);return t;function s(n,e){return"number"!=typeof n&&(n=0),"number"!=typeof e&&(e=0),e<n?1:n<e?-1:0}},g=function(e){var t=(window.FLPPJSBridge||{}).version;if(!t)return!1;if(d){if("ios"===l){var r=("object"===n(e)?e.ios:e)||f;return-1<v(t,r)}var o=("object"===n(e)?e.android:e)||f;return-1<v(t,o)}return!1},m=function(){return d&&sessionStorage.getItem("token")||""},y=function(){var e=window.FLPPJSBridge||{};return d&&"object"===n(window.FLPPJSBridge)?(e.env+"").toUpperCase()||void 0:""},w=function(){var e=window.FLPPJSBridge||{};return d&&"object"===n(window.FLPPJSBridge)?e.version:""},h=function(){return d?!!sessionStorage.getItem("token"):""},b=function(){return t({},window.FLPPJSBridge,{token:m(),env:y(),version:w(),isLogin:h(),os:l})},P=(function(n){var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(e){var t=new Uint8Array(16);n.exports=function(){return e(t),t}}else{var r=new Array(16);n.exports=function(){for(var n,e=0;e<16;e++)0==(3&e)&&(n=4294967296*Math.random()),r[e]=n>>>((3&e)<<3)&255;return r}}}(o={exports:{}}),o.exports),S=[],O=0;O<256;++O)S[O]=(O+256).toString(16).substr(1);var j=function(n,e,t){var r=e&&t||0;"string"==typeof n&&(e="binary"===n?new Array(16):null,n=null);var o=(n=n||{}).random||(n.rng||P)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e)for(var i=0;i<16;++i)e[r+i]=o[i];return e||function(n,e){var t=e||0,r=S;return[r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]]].join("")}(o)},x=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=n.action;e.handle?e.handle(n,b()):("success"===t&&e.success&&e.success(n,b()),"fail"===t&&e.fail&&e.fail(n,b()),e.complete&&e.complete(n,b()))},L=function(e){if(r=e,o={},d?r.version&&!g(r.version)&&(o={message:"not use api,because app notSupport",action:"notSupport"}):o={message:"not pipiapp environment",action:"notApp"},!o.action||(x(o,r),0)){var r,o,i,a,s=e.handle,u={cmd:e.cmd};s&&(u.handle=function(e,t){if(e){var r=!1,o=e;"object"===n(e)&&(o=e.callBack,r=!!e.keep);var i=["a","b","c","d","e","f","g","h","i","g","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"][Math.round(25*Math.random())]+j().replace(/-/g,"");return p.on(i,(function(n){var e=t.cmd;"func.ready"!==e&&"func.login"!==e||window.FLPPJSBridge||(window.FLPPJSBridge=n.data),x(n,t),r||(p.off(i,o),delete window[i])})),window[i]=function(n){p.emit(i,n)},i}}(s,e)),e.data&&(u.data=e.data),-1!==(a=(i=t({},u)).cmd).indexOf(".")&&(a=a.split("."),i.api=a[1],a=a[0]),"ios"===l?window.webkit.messageHandlers[a].postMessage(i):"android"===l&&window["flppAndroid"+a].postMessage(JSON.stringify(i))}},J=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"&",r="";for(var o in e){var i=e[o];""!==i&&(r+=o+"="+encodeURIComponent("object"===n(i)?JSON.stringify(i):i)+t)}return r?r.substr(0,r.length-1):""},k=function(n){var e=function(n){var e=window.location.hash,t=window.location.search;if(n){var r=n.indexOf("#"),o=n.indexOf("?");if(e=-1!==r?n.substr(r):"",o<r||-1!==o&&-1===r){var i=o<r?r-o:n.length;t=n.substr(o,i)}else t=""}return{hash_str:e,search_str:t}}(n),t=e.hash_str,r=e.search_str,o=t.indexOf("?");t=-1!==o?t.substr(o+1)+"&":"";var i=r.indexOf("?");-1!==i&&(r=r.substr(i+1));var a={};if(-1!==o||-1!==i)for(var s=(t+r).split("&"),u=0;u<s.length;u++){var c=s[u].split("=");if(c[0]){var d="";try{d=decodeURIComponent(c[1])}catch(n){d=c[1]}a[c[0]]=d}}return a},A="func.login",B="func.goBack",F="func.ready",C="func.openAppPage",I={};function R(n,e){var t=e.data,r=void 0===t?{}:t;r.token&&I.set(r.token),n&&n({data:b(),action:e.action,message:e.message},b())}return I.format=function(n){return""===n||"null"===n?"":n},I.set=function(n){var e=I.format(n);e&&sessionStorage.setItem("token",e)},{os:l,isPiPiApp:d,invoke:L,isCanIUse:g,login:function(n){L({cmd:A,handle:function(e){R(n,e)},version:"1.2.9"})},ready:function(n){function e(){window.FLPPJSBridge?R(n,{data:window.FLPPJSBridge,action:"success",message:""}):L({cmd:F,handle:function(e){R(n,e)}})}window.FLPPJSBridge?R(n,{data:window.FLPPJSBridge,action:"success",message:""}):"complete"===document.readyState?e():document.addEventListener("DOMContentLoaded",(function(){e()}),!0)},openWindow:function(e){if(d){var o=e.version||"",i={},a={},s={},u=e.ios,c=e.android;"object"===n(e.android)&&(i.android=e.android.version||"",a=e.android.query||{},c=e.android.url),"object"===n(e.ios)&&(i.ios=e.ios.version||"",s=e.ios.query||{},u=e.ios.url),o=o||i;var f=function(n,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"&",r=-1!==n.indexOf("?")?t:"?";return n+(e?r:"")+e};if(e.url){var p=e.url;s={},c={};var v=k(p),g={};void 0!==v.hideNavi&&(g.hideNavi=v.hideNavi),void 0!==v.title&&(g.title=v.title);var m=J(g);m=m?"&"+m:"",u="FLWebPageViewController?urlString="+encodeURIComponent(e.url)+m,c="WebViewActivity?url="+encodeURIComponent(e.url)}var y=function(){var n=e.query,o={},i={ios:{},android:{}};for(var a in n){var s=a+"";if(-1!==s.indexOf("["))for(var u=s.substr(1,s.length-2).split(","),c=0;c<u.length;c++){var d=r(u[c].split(":"),2),f=d[0],p=d[1];i[f][p]=n[a]}else o[a]=n[a]}return t({},o,{},i[l])};return L({version:o,data:{para:JSON.stringify({ios:{ios_route:f(u,J(t({},s,{},y())))},android:{androidRoute:f(c,J(t({},a,{},y())))}}[l])},cmd:C,handle:e.handle})}e.href&&(window.location.href=e.href)},getToken:m,getVersion:w,getEnv:y,getApp:b,isLogin:h,back:function(){L({cmd:B})},getStitchingUrlParams:J,getRequestUrlParam:k}}));
